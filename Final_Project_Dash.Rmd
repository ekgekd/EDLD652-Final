---
title: "EDLD652 Final"
author: "Diana Dewald, Eliott Doyle"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)

library(tidyverse)
library(ggplot2)
library(rio)
library(here)
library(tidytext)
library(RColorBrewer)
library(viridis)

#opening and removing about 90% of the rows since the file was too big to push! This code won't work since I got rid of the blogtext.csv file 
#data1 <- import(here("blogtext.csv"))
#data1 <- data1[-(60000:681284),]
#write.csv(data1, "blogtextabbr.csv")

#reading in the new df with fewer observations
data <- import(here("blogtextabbr.csv"))

#making all text in 'text' lowercase
data <- data %>% 
  mutate(text = tolower(text))

#View(data)

m_age <- mean(data$age, na.rm = T)
m_age
max_age <- max(data$age, na.rm = T)
max_age
min_age <- min(data$age, na.rm = T)
min_age

#creating a new column with three groups for age
data <- data %>% 
  mutate(agegroup = cut(age, 
                        breaks =c (-Inf, 19.9, 30, Inf), 
                        labels=c("Under 20","20s","Over 30")))
#head(data)


#parsing words from the 'text' column
tidy_words <- data %>% 
  unnest_tokens(word, text)

#removing numbers
tidy_words <- tidy_words[-grep("\\b\\d+\\b", tidy_words$word),]

#removing common/under-informative words
exclu <- tibble(word = c("nbsp","urllink", "lot", "â", "im", "pm", "blog", "stuff", "lol"))
tidy_words <- tidy_words %>% 
  anti_join(exclu, by = "word")
#head(tidy_words)

#counting most frequently occurring words, removing stop words from counts
# tidy_words %>% 
#  anti_join(stop_words) %>%
#  count(word, sort = TRUE)

#new df, converting the date column to dates
rq3 <- data
rq3$date <- gsub(",", "/", rq3$date)
#head(rq3)
rq3$date <- gsub("January", "01", rq3$date)
rq3$date <- gsub("February", "02", rq3$date)
rq3$date <- gsub("March", "03", rq3$date)
rq3$date <- gsub("April", "04", rq3$date)
rq3$date <- gsub("May", "05", rq3$date)
rq3$date <- gsub("June", "06", rq3$date)
rq3$date <- gsub("July", "07", rq3$date)
rq3$date <- gsub("August", "08", rq3$date)
rq3$date <- gsub("September", "09", rq3$date)
rq3$date <- gsub("October", "10", rq3$date)
rq3$date <- gsub("November", "11", rq3$date)
rq3$date <- gsub("December", "12", rq3$date)
#head(rq3)
rq3$date <- as.Date(rq3$date, format="%d/%m/%Y")
#head(rq3)
```

# RQ1

---
title: "EDLD652 Final"
output: flexdashboard::flex_dashboard
runtime: shiny
---

Inputs {.sidebar}
-----------------------------------------------------------------------

**Goal:** communicate the most frequently used words in the corpus to an audience of bloggers with no particular history with statistics. Ideally, the people who contributed to this corpus would be able to read this graph to learn more about the project they contributed to.

**Draft 1:** Shows frequencies of the 15 most frequently occurring words. The words do not appear in any order, and there isn't a lot of aesthetic appeal.

**Draft 2:** The words have been reordered to go from most common to least common of the 15 most common words so improve readability. I added some color, changed the theme, and removed some gridlines to improve aesthetic appeal, and removed the space between the words and the bars to help with visual flow.

**Final version:** I added more words so that some of the words that appear only in the charts for RQ2 appear here as well, as a preview of the next visualizations. I also added age group to the variables being presented here, to show how popular each word is amount each age bracket — also as a nod to what will be shown in RQ2 and RQ3's visualizations. We can see that people in their 20s are using common words more often than people in their teens (who make up a similar proportion of the corpus) and people over 30 (who make up a smaller proportion of the corpus).



Column {data-width=650}
-----------------------------------------------------------------------

### Final Version

```{r rq1v}
#plot v3

my_colors <- brewer.pal(4, "Blues")[2:4]

tidy_words %>% 
  anti_join(stop_words) %>% 
  count(word, agegroup, sort = TRUE) %>% 
  mutate(word = reorder(word, n)) %>% # make y-axis ordered by n
  slice(1:32) %>% # select only the first 20 rows
  ggplot(aes(n, word, fill = agegroup)) +
  geom_col(position = "stack",
           alpha = .7) +
  scale_x_continuous(expand = c(0,0),
                     labels = scales::comma) +
  theme_minimal() +
  scale_fill_manual(values = my_colors) + 
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.x = element_line(color = "gray80")
  ) +
  labs(
    x = "Word Frequency",
    y = "Word",
    title = "Top 20 most frequently occurring words across all blog posts",
    fill = "Blogger Age",
    caption = "Data abbreviated from https://www.kaggle.com/rtatman/blog-authorship-corpus"
  )
```

Column {data-width=350}
-----------------------------------------------------------------------

### Draft 2

```{r rq1v2, warning= FALSE, echo = FALSE, message = FALSE}
#plot v2
tidy_words %>% 
  anti_join(stop_words) %>% 
  count(word, sort = TRUE) %>% 
  mutate(word = reorder(word, n)) %>% # make y-axis ordered by n
  slice(1:15) %>% # select only the first 15 rows
  ggplot(aes(n, word)) +
  geom_col(fill = "cornflowerblue") +
  scale_x_continuous(expand = c(0,0)) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.x = element_line(color = "gray80")
  ) +
  labs(
    x = "Word Frequency",
    y = "Word",
    title = "Top 15 most frequently occurring words across all blog posts",
    caption = "Data abbreviated from https://www.kaggle.com/rtatman/blog-authorship-corpus"
  )
```

### Draft 1

```{r rq1v3, warning= FALSE, echo = FALSE, message = FALSE}
#plot v1

tidy_words %>% 
  anti_join(stop_words) %>% 
  count(word, sort = TRUE) %>% 
  slice(1:15) %>% # select only the first 15 rows
  ggplot(aes(n, word)) +
  geom_col() +
  labs(
    x = "Word Frequency",
    y = "Word",
    title = "Top 15 most frequently occurring words across all blog posts",
    caption = "Data abbreviated from https://www.kaggle.com/rtatman/blog-authorship-corpus"
  )
```

# RQ2

Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r}

```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}

```

### Chart C

```{r}

```

# RQ3

Inputs {.sidebar}
-----------------------------------------------------------------------

**Goal:** communicate the relationship between date, word count, and blogger age (if any relationship exists) to an audience of people who might have contributed to the corpus.

**Draft 1:** Shows only total word count by date. This graph is somewhat misleading, because the word counts are affected by how many blog posts from the corpus were made on a given day: it is not necessarily that people suddenly started writing longer posts; there are just more posts being included after 2004. This visualization also does not have much visual appeal, and the y-axis is annoying to read.

**Draft 2:** I added age group to the plot to add some visual interest through color. The axes have also been changed to give some more spread to the data (without making the y-axis log10, the data are mostly squished down at the bottom, with only a few outliars reaching up to 10k or 100k words)

**Final version:** Since there was not much relationship between date posted and word count, I broke the visualization apart into three plots, one for each age group, and added age as a continuous variable within that to show more of the variety. What we can see now is that people in their 20s started making more blog posts at earlier dates (at least within this corpus) than people under 20 or over 30, suggesting that, if one were to look only at the early years of the dataset, 20-somethings would be overrepresented compared to the overall age breakdown of the dataset. I kept the trend lines for all three groups, although I think this is more informative in draft 2, since it is harder to compare their slops when they are not on the same plot. 


Column {data-width=650}
-----------------------------------------------------------------------

### Final Version

```{r rq3v3, warning= FALSE, echo = FALSE, message = FALSE}
#plot v3
rq3_plot4 <- rq3 %>% 
  select(id, text, date, agegroup, age) %>% 
  group_by(id, text, date, agegroup, age) %>% 
  unnest_tokens(word, text) %>% 
  summarize(count = n()) %>% 
  ggplot(aes(x=date, 
             y=count,
             colour = age)) +
  geom_point(alpha = .3) +
  theme_classic() +
  theme() +
  scale_color_viridis(option = "plasma") +
  scale_y_log10(labels = scales::comma) +
  scale_x_date(date_labels = "%Y", expand = c(0,0)) +
  geom_smooth(method=lm, se=FALSE, color = "black", size = .5) +
  labs(
    x = "Date Posted",
    y = "Number of Words",
    title = "Word Count by Blogger by Date",
    color = "Blogger Age",
    caption = "Data abbreviated from https://www.kaggle.com/rtatman/blog-authorship-corpus") +
  facet_grid("agegroup")

rq3_plot4
```

Column {data-width=350}
-----------------------------------------------------------------------

### Draft 2

```{r rq3v2, warning= FALSE, echo = FALSE, message = FALSE}
#plot v2
rq3_plot2 <- rq3 %>% 
  select(id, text, date, agegroup) %>% 
  group_by(id, text, date, agegroup) %>% 
  unnest_tokens(word, text) %>% 
  summarize(count = n()) %>% 
  ggplot(aes(x=date, 
             y=count,
             colour = agegroup)) +
  geom_point(alpha = .5) +
  theme_bw() +
  scale_color_brewer(palette="Blues") +
  scale_y_log10(labels = scales::comma) +
  scale_x_date(date_labels = "%Y", expand = c(0,0)) +
  geom_smooth(method=lm, se=FALSE) +
  labs(
    x = "Date Posted",
    y = "Number of Words",
    title = "Word Count by Blogger by Date",
    color = "Blogger Age"
  ) 

rq3_plot2
```

### Draft 1

```{r rq3v1, warning= FALSE, echo = FALSE, message = FALSE}
#plot v1
rq3_plot1 <- rq3 %>% 
  select(text, date) %>% 
  group_by(text, date) %>% 
  unnest_tokens(word, text) %>% 
  summarize(count = n()) %>% 
  ggplot(aes(x=date, 
             y=count)) +
  geom_point(alpha = .5) +
  theme_bw() +
  labs(
    x = "Date Posted",
    y = "Number of Words",
    title = "Word Count by Date"
  ) 

rq3_plot1
```
